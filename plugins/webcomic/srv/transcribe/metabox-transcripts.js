!function(){"use strict";!function e(){if("loading"===document.readyState)return document.addEventListener("DOMContentLoaded",e);function n(e){for(var t=e;t.tagName&&!t.classList.contains("webcomic-transcript-form");)t=t.parentNode;if(t.tagName&&t.classList.contains("webcomic-transcript-form")){var r=t.querySelector(".webcomic-media");r.style.display&&"block"!==r.style.display?r.style.display=null:r.style.display="none"}}function c(t,r){for(var e=t;e.tagName&&!e.classList.contains("inside");)e=e.parentNode;if(e.tagName&&e.classList.contains("inside")&&(e=e.querySelector("fieldset")))return s(e.parentNode,t,r);var n=new FormData,a=new XMLHttpRequest;n.append("action","webcomic_transcribe_form"),n.append("parent",document.querySelector("#post_ID").value),n.append("post",r),a.onreadystatechange=function(){if(4===a.readyState){var n,e=document.createElement("div");e.innerHTML=a.responseText,(n=e).querySelector(".button-primary").addEventListener("click",function(e){var o,t,c,i,r;e.preventDefault(),o=n,t=new FormData,c=new XMLHttpRequest,i=o.querySelector("[data-id]").getAttribute("data-id"),r=function(e){for(var t=e.querySelectorAll('[type="checkbox"]'),r=[],n=0;n<t.length;n++)t[n].checked&&r.push(t[n].value);return r}(o),t.append("action","webcomic_transcribe_submit"),t.append("post",i),t.append("post_parent",document.querySelector("#post_ID").value),t.append("post_content",o.querySelector("textarea").value),t.append("post_status",o.querySelector(".status").value),t.append("post_languages",r),t.append("Mgsisk\\Webcomic\\Transcribe\\MetaBoxSubmitTranscriptNonce",o.querySelector('[type="hidden"]').value),c.onreadystatechange=function(){if(4===c.readyState)if(0!==c.responseText.indexOf("ERROR")){if("0"===i){for(var e=o.parentNode;e.tagName&&!e.classList.contains("inside");)e=e.parentNode;r=e.querySelector("tbody"),t=c.responseText,n=new FormData,a=new XMLHttpRequest,n.append("action","webcomic_transcribe_row"),n.append("post",t),a.onreadystatechange=function(){if(4===a.readyState&&0!==a.responseText.indexOf("ERROR")){var e=document.createElement("tbody"),t=r.querySelector("tr:last-child");e.innerHTML=a.responseText,d(e),r.insertBefore(e.children[0],r.querySelector("tr")),t.classList.contains("none")&&r.removeChild(t)}},a.open("POST",ajaxurl),a.send(n)}var r,t,n,a;o.querySelector("textarea").classList.add("saved"),s(o)}else o.querySelector(".error").innerHTML=c.responseText},c.open("POST",ajaxurl),c.send(t)}),n.querySelector(".button-secondary").addEventListener("click",function(e){e.preventDefault(),s(n)}),n.querySelector("textarea").addEventListener("keyup",function(e){"escape"===e.key.toLowerCase()&&s(n)}),n.querySelector(".webcomic-media").addEventListener("click",function(e){for(var t=e.target;t.tagName&&!t.classList.contains("webcomic-media");)t=t.parentNode;if(t.tagName&&t.querySelector("img")){if(t.classList.contains("contain"))return t.classList.remove("contain"),void(t.style.height="auto");var r=Number(t.querySelector("img").getAttribute("width")),n=Number(t.querySelector("img").getAttribute("height")),a=r/n,o=n/2*a;t.classList.add("contain"),t.style.height="".concat(o,"px")}}),n.querySelector(".webcomic-media").style.display="none",r?(t.innerHTML='<td colspan="3"></td>',t.children[0].appendChild(e)):(t.querySelector(".add-transcript").parentNode.style.display="none",t.insertBefore(e,t.querySelector(".webcomic-transcripts"))),quicktags({id:"webcomic_transcript_content",buttons:"strong,em,link,block,del,ins,ul,ol,li,code,close"}),QTags._buttonsInit(),e.querySelector("textarea").style.height="".concat(e.querySelector("textarea").scrollHeight,"px"),e.querySelector("textarea").focus()}},a.open("POST",ajaxurl),a.send(n)}function s(r,n,a){var e=r.querySelector("textarea");if(e.classList.contains("saved")||e.value===e.defaultValue||window.confirm(webcomicTranscriptL10n.warn)){if(r.parentNode.classList.contains("inside"))return r.parentNode.querySelector(".add-transcript").parentNode.style.display=null,r.parentNode.removeChild(r),void(n&&c(n,a));var t=new FormData,o=new XMLHttpRequest;t.append("action","webcomic_transcribe_row"),t.append("post",r.querySelector("[data-id]").getAttribute("data-id")),o.onreadystatechange=function(){if(4===o.readyState)if(0!==o.responseText.indexOf("ERROR")){for(var e=document.createElement("tbody"),t=r;t.tagName&&"tr"!==t.tagName.toLowerCase();)t=t.parentNode;e.innerHTML=o.responseText,d(e),t.parentNode.replaceChild(e.children[0],t),n&&c(n,a)}else r.querySelector(".error").innerHTML=o.responseText},o.open("POST",ajaxurl),o.send(t)}}function d(e){e.querySelector(".quickedit a").addEventListener("click",function(e){e.preventDefault();var t=e.target.parentNode.parentNode.parentNode.parentNode;c(t,t.getAttribute("data-id"))}),e.querySelector(".trash a").addEventListener("click",function(e){var r,t,n,a,o;e.preventDefault(),r=e.target.parentNode.parentNode.parentNode.parentNode,t=new FormData,n=new XMLHttpRequest,a=r.getAttribute("data-id"),o=r.querySelector(".trash a").href,t.append("action","webcomic_transcribe_trash"),t.append("post",a),t.append("_wpnonce",o.substr(o.indexOf("_wpnonce")+9)),n.onreadystatechange=function(){4===n.readyState&&(0!==n.responseText.indexOf("ERROR")?(r.innerHTML=n.responseText,r.querySelector("a").addEventListener("click",function(e){e.preventDefault();var t=new FormData;t.append("action","webcomic_transcribe_untrash"),t.append("post",a),t.append("_wpnonce",e.target.href.substr(e.target.href.indexOf("_wpnonce")+9)),n.onreadystatechange=function(){4===n.readyState&&(0!==n.responseText.indexOf("ERROR")?(r.innerHTML=n.responseText,d(r)):r.querySelector(".js-error").innerHTML=n.responseText)},n.open("POST",ajaxurl),n.send(t)})):r.querySelector(".js-error").innerHTML=n.responseText)},n.open("POST",ajaxurl),n.send(t)})}"auto-draft"!==document.querySelector("#original_post_status")&&function(e){var t=e.querySelectorAll("tr");QTags.addButton("comic",webcomicTranscriptL10n.comic,n,"","g","",0,"webcomic_transcript_content"),function(t){if(t.querySelector(".add-transcript"))return;var e=document.createElement("p");e.innerHTML='<a href="#" class="button add-transcript">'.concat(webcomicTranscriptL10n.add,"</a>"),e.addEventListener("click",function(e){e.preventDefault(),c(t,0)}),t.insertBefore(e,t.querySelector(".webcomic-transcripts"))}(e);for(var r=0;r<t.length;r++)t[r].classList.contains("none")||d(t[r])}(document.querySelector("#Mgsisk_Webcomic_Transcribe_MetaBoxTranscripts .inside"))}()}();
